$(function(){(function(n){n.qfangFormValidationEffect={focus:function(){var r=n(this);var o=r.siblings(".lf-label");var p=r.siblings(".field-text");var q=n.trim(r.val());r.addClass("focus").removeClass("wrong");if(q==""){if(!o.is(":animated")){o.hide().addClass("up").stop(false,true).animate({"top":-20},300);}if(!p.is(":animated")){p.show().addClass("up").stop(false,true).animate({"top":-20},300);}}},blurValIsEmpty:function(s,r){var t=s;var q=t.parent().siblings(".field");var o=t.siblings(".lf-label");var p=t.siblings(".field-text");t.removeClass("focus").addClass("wrong");q.removeClass("right");if(!o.is(":animated")){o.show().text(!r?"请配置文字信息":r).addClass("wrong").removeClass("up").stop(false,true).animate({"top":0},300,function(){o.addClass("flash-delayed");setTimeout(function(){o.removeClass("flash-delayed");},1100);});}if(!p.is(":animated")){p.hide().removeClass("up").stop(false,true).animate({"top":0},300);}},right:function(r){var s=r;var q=s.parent().siblings(".field");var o=s.siblings(".lf-label");var p=s.siblings(".field-text");p.show();o.hide();q.addClass("right");s.removeClass("focus wrong");},error:function(s,r){var t=s;var q=t.parent().siblings(".field");var o=t.siblings(".lf-label");var p=t.siblings(".field-text");t.removeClass("focus").addClass("wrong");q.removeClass("right");p.hide();if(!o.is(":animated")){o.show().text(!r?"请配置文字信息":r).addClass("wrong").addClass("up").stop(false,true).animate({"top":-20},1,function(){o.addClass("flash");setTimeout(function(){o.removeClass("flash");},1000);});}}};})(jQuery);$("body").on("keypress",".js-only-num",function(o){var n=o.keyCode?o.keyCode:o.which;if((n<48||n>57)&&n!==8&&n!==46){return false;}});$("#makeAppointmentBtn, #checkHouseBtn").on("click",function(){$.qfangDialog.DialogShow("takeLookDialog",{callback:function(){$(".take-look-form").show();$(".take-look-succeed").hide();var n=$('.take-look-form input[value=""], .take-look-form input.wrong').not(".lf-keyword-other").eq(0);n.trigger("focus");}});});$('#takeLookClose, [data-type="continue"]').on("click",function(){$.qfangDialog.DialogClose("takeLookDialog");});$("body").on("click",".js-date p",function(){if(!$(this).hasClass("cur")){$(this).addClass("cur").siblings().removeClass("cur");if($(this).index()==0){$(".js-time").addClass("dn");$(this).parents(".take-look-container").height(430);}else{$(".js-time").removeClass("dn");$(this).parents(".take-look-container").height(520);}}});$("body").on("click",".js-time p",function(){if(!$(this).hasClass("cur")){$(this).addClass("cur").siblings().removeClass("cur");}});$(".lf-keyword-other").placeholder();$('.take-look-form input[type="text"]').val("");$("body").on("focus","#name",$.qfangFormValidationEffect.focus).on("blur","#name",function(){e(this);});function e(o){var q=$(o);var p=$.trim(q.val());if(p==""){q.attr("value","");$.qfangFormValidationEffect.blurValIsEmpty(q,"称呼一定要填哦");return false;}else{q.attr("value",p);var n=/^[\u4e00-\u9fa5a-z]+$/;if(n.test(p)){$.qfangFormValidationEffect.right(q);return true;}else{$.qfangFormValidationEffect.error(q,"称呼填写不正确哦");return false;}}}$("body").on("focus","#telNum",$.qfangFormValidationEffect.focus).on("blur","#telNum",function(){m(this);}).on("keyup","#telNum",function(){var p=$(this);var n=$.trim(p.val());if(n.length){var o=/^[1][3578]\d{9}$/;if(o.test(n)){$("#getVCode").removeClass("mb-msg-code-disable");}else{$("#getVCode").addClass("mb-msg-code-disable");}}else{$("#getVCode").addClass("mb-msg-code-disable");}});function m(n){var q=$(n);var o=$.trim(q.val());if(o==""){q.attr("value","");$.qfangFormValidationEffect.blurValIsEmpty(q,"手机号一定要填哦");return false;}else{q.attr("value",o);var p=/^[1][3578]\d{9}$/;if(p.test(o)){$.qfangFormValidationEffect.right(q);return true;}else{$.qfangFormValidationEffect.error(q,"手机号填写不正确哦");return false;}}}$("body").on("focus","#vcode",$.qfangFormValidationEffect.focus).on("blur","#vcode",function(){var n=$(this);c(n);});function c(n){var p=$(n);var o=$.trim(p.val());if(o==""){p.attr("value","");$.qfangFormValidationEffect.blurValIsEmpty(p,"验证码一定要填哦");return false;}else{p.attr("value",o);if(o.length==6){$.qfangFormValidationEffect.right(p);return true;}else{$.qfangFormValidationEffect.error(p,"验证码填写不正确哦");return false;}}}var b;var l=function(){var p=$("#telNum");var t=$.trim(p.val());var r=t.length;var o=/^[1][3578]\d{9}$/;if(r!==11||!o.test(t)){$.qfangFormValidationEffect.error(p,"手机号填写不正确哦");return;}var n=$("#getVCode"),q=n.html(),s=60;if(!n.hasClass("mb-msg-code-disable")){p.removeClass("wrong");n.html(s+"秒后重新获取").addClass("mb-msg-code-disable");b=setInterval(function(){s-=1;if(s===0){clearInterval(b);n.html(q).removeClass("mb-msg-code-disable");}else{n.html(s+"秒后重新获取");}},1000);}};$("body").on("click","#getVCode",function(){if(!m($("#telNum"))){return false;}if(!$(this).hasClass("mb-msg-code-disable")){d();}});$("body").on("click",".confirm-close",function(){$(this).parent().addClass("dn");});function f(){$("#codeImg").attr("src",ctx+"/checkCode/getValidateCode?r="+Math.random());}function i(){$("#pictureVerifDiv").hide();}function d(){if($("#imgCode-box").data("validate")){g();}else{$("#imgCode-box").data("successEleClick","#getVCode");$.qfangDialog.DialogShow("imgCode-box");$("#imgCode-box").find("#imgCodeText").val("").next().show();$("#imgCode-box").find(".gvcode-area").trigger("click");$("#imgCode-box").find("#imgCodeText").focus();}}$("#pictureVerifOk").on("click",function(n){g();});function g(){var n=j();$.ajax({url:ctx+"/base/sendMsgWithoutCode",data:n,type:"post",cache:false,dataType:"json",success:function(o){if(o.flag=="1"){i();l();$("#imgCode-box").data("validate",false);$.qfangAlertTips.Okay("已发送短信，请注意查收",2000);$("#vcode").focus();}},error:function(){$.qfangAlertTips.Warning("系统繁忙请稍后再试",2000);}});}function k(){$.ajax({url:ctx+"/base/appointdate",type:"post",cache:false,dataType:"json",success:function(q){if(q.ret==0){var r=q.appointDateDataMapList;if(r){$("#lookDateId").empty();$("#lookDateId").append('<p class="at-any-time cur fl"><span>随时</span><i class="icons"></i></p>');for(index in r){var o=r[index];if(o&&o.weekDay&&o.simpleCurrentDate){var w=o.weekDay;var t=o.simpleCurrentDate;var u=o.fullCurrentDate;var v='<p class="fl" data-value="'+u+'"><span>'+w+"</span><b>"+t+'</b><i class="icons"></i></p>';$("#lookDateId").append(v);}}}var x=q.appointTimeDataMapList;if(x){$("#lookTimeId").empty();$("#lookTimeId").append('<p class="at-any-time cur fl"><span>全天</span><i class="icons"></i></p>');for(index in x){var y=x[index];if(y&&y.desc){var p=y.timeQuantum;var s=y.desc;var n=y.name;var v='<p class="fl" data-value="'+n+'"><span>'+s+"</span><b>"+p+'</b><i class="icons"></i></p>';$("#lookTimeId").append(v);}}}}else{}},error:function(){}});}$("body").on("click","#to_submitOrder",function(){h();});function j(){var M=$.trim($("#name").val());var s=$.trim($("#telNum").val());var r=$.trim($("#vcode").val());var x=$.trim($("#extraInfo").val());var y=$("#lookDateId .cur").attr("data-value");var J=$("#lookTimeId .cur").attr("data-value");if(!y||y==undefined){y="随时";}if(!J||J==undefined){J="DEFAULT";}var w=$.trim($("input[name='sex']").val());var H=$.trim($("input[name='roomBizType']").val());var o=$.trim($("input[name='roomId']").val());var z=$.trim($("input[name='roomInternalID']").val());var L=$.trim($("input[name='brokerAccountId']").val());var v=$.trim($("input[name='brokerName']").val());var G=$.trim($("input[name='brokerMobile']").val());var I=$.trim($("input[name='roomNumber']").val());var F=$.trim($("input[name='gardenName']").val());var t=$.trim($("input[name='appointMentpicUrl']").val());var A=$.trim($("input[name='appointMentbedRoom']").val());var p=$.trim($("input[name='appointMentlivingRoom']").val());var u=$.trim($("input[name='appointMenttotalPrice']").val());var B=$.trim($("input[name='appointMentarea']").val());var q=$.trim($("input[name='system']").val());var E=$.trim($("input[name='appointDirection']").val());var n=$.trim($("input[name='appointFloor']").val());var D=$.trim($("input[name='appointTotalFloor']").val());var C=$.trim($("input[name='appointBizType']").val());var K={nickName:M,sex:w,explains:x,mobilephone:s,lookDate:y,lookTimeValue:J,variCode:r,sex:w,roomBizType:H,roomId:o,roomInternalID:z,brokerAccountId:L,brokerName:v,brokerMobile:G,roomNumber:I,gardenName:F,appointMentpicUrl:t,appointMentbedRoom:A,appointMentlivingRoom:p,appointMenttotalPrice:u,appointMentarea:B,system:q,direction:E,floor:n,totalFloor:D,appointBizType:C};return K;}function a(){$("#name").val("");$("#telNum").val("");$("#vcode").val("");$("#extraInfo").val("");$(".js-date p").removeClass("cur");$(".js-time p").removeClass("cur");$(".js-date p:first").addClass("cur");$(".js-time p:first").addClass("cur");if(b){clearInterval(b);}$("#getVCode").html("获取短信验证码").removeClass("mb-msg-code-disable");}function h(){if(!e($("#name"))){return false;}if(!m($("#telNum"))){return false;}if(!c($("#vcode"))){return false;}var n=j();$.ajax({url:ctx+"/base/saveSMSOrder",data:n,type:"post",cache:false,dataType:"json",success:function(p){if(p.flag=="3"){$.qfangAlertTips.Warning("短信验证码输入错误",2000);}else{if(p.flag=="4"){var q=$("#ID_lookMyAppoint").attr("href");if(q&&p.sid){q=q.substring(q.indexOf("?"));q+="?sid="+p.sid;$("#ID_lookMyAppoint").attr("href",q);}$(".take-look-form").hide();$(".take-look-succeed").show();a();if($('[key="orderCount"]')){var o=$('[key="orderCount"]').html()*1+1;$('[key="orderCount"]').html(o);}}else{if(p.flag=="5"){$.qfangAlertTips.Warning("系统繁忙请稍后再试！",2000);}else{if(p.flag=="6"){$.qfangAlertTips.Warning("请先获取短息验证码！",2000);}else{if(p.flag=="2"){$.qfangAlertTips.Warning("您今天已经申请超过10次！",2000);}}}}}},error:function(){$.qfangAlertTips.Warning("系统繁忙请稍后再试！",2000);}});}k();$("#continueFind").click(function(){$(".take-look-succeed").hide();});});